# Calliope - AI 分步式长篇写作智能体 (v4.0)

Calliope 是一个基于大语言模型（LLM）的专业级长篇创作工作站。它模拟资深作家的分步骤工作流（规划 -> 研究 -> 大纲 -> 撰写 -> 修订），并通过独创的 **Hybrid RAG（图谱+向量混合检索）** 技术，彻底解决了长篇创作中容易出现的设定矛盾、人物 OOC 和情节遗忘等行业痛点。

## ✨ 核心特性

*   **分层服务架构 (Service-Oriented)**: 逻辑、UI、AI 链、存储层 100% 解耦，具备企业级的可维护性和扩展性。
*   **双路知识引擎 (Hybrid RAG)**: 
    *   **Vector Retrieval**: 利用 ChromaDB 维护情节摘要和研究资料。
    *   **GraphRAG 3.0**: 利用 NetworkX 维护硬核关系网，支持多跳检索、自动派系识别、在线图形编辑及逻辑冲突实时预警。
*   **Writer-Critic 协同创作**: 
    *   内置“AI 评审员”，在每个创作节点提供多维度反馈。
    *   支持“一键采纳建议”并自动重写，实现人机协同的极速迭代。
*   **极速性能体验**: 
    *   **并行化研究**: 搜索指令并发执行，效率提升 3 倍。
    *   **流式响应**: 逐字生成，零心理等待时间。
*   **专业交付**: 支持导出为 Markdown, PDF 和 EPUB 格式，一键生成成品电子书。

## 🚀 技术栈

*   **AI 编排**: Python 3.9+, LangChain (LCEL)
*   **数据存储**: ChromaDB (向量), NetworkX (图谱), JSON (状态)
*   **视觉交互**: Streamlit, Streamlit-Agraph
*   **文件导出**: fpdf2, EbookLib

## 📖 核心工作流 (The Calliope Way)

1.  **设定百科 (Project Bible)**: 输入世界观，系统自动构建人物关系图谱。
2.  **动态创作**: 撰写章节时，系统自动识别场上实体，精准调取关联设定。
3.  **实时审计**: 系统自动检测新剧情是否与图谱设定冲突。
4.  **知识沉淀**: 撰写完成的章节会自动生成摘要并反哺图谱，实现知识的动态生长。

## 📝 待办清单 (Roadmap 4.0)

*   [x] **UI 组件化重构**: 拆分 800 行单体文件，实现模块化交互。
*   [x] **Service 逻辑解耦**: 建立 Writing/Knowledge/Research 独立服务层。
*   [ ] **设定管理整合 (Bible 2.0)**: 实现文字设定与图谱关系的强实时同步。
*   [ ] **混合检索优化 (Hybrid RAG)**: 实现基于实体的图谱过滤检索，消除 AI 幻觉。
*   [ ] **侧边栏动态百科**: 实现写作时自动浮现的相关人物/设定挂件。
*   [ ] **非线性叙事管理**: 引入故事时间轴（Chronology）和叙事分支（What-if）。

---
**License:** MIT